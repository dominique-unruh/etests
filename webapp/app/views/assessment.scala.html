@import views.html.helper.CSRF
@import play.api.libs.json.Json
@import play.api.libs.json.JsObject
@import assessments.ElementName
@import scala.jdk.CollectionConverters.given
@(
        examName: String,
        assessmentName: String,
        title: String,
        initialState: JsObject,
        reachablePoints: String,
        body: Html,
        explanation: Html,
        gradingRules: Html)(implicit requestHeader: RequestHeader)

<!DOCTYPE html>
<html lang="en">
    <head>
        <title>@title</title>
        <link rel="stylesheet" media="screen" href="@routes.Assets.versioned("stylesheets/main.css")">
@*        <link rel="shortcut icon" type="image/png" href="@routes.Assets.versioned("images/favicon.png")">*@
        <script type="text/javascript" src="@routes.MiscController.javascriptRoutes"></script>
        <!--suppress JSUnresolvedLibraryURL -->
        <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@@3/es5/tex-mml-chtml.js"></script>
        <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
        <script> @* misc configuration *@
            window.MathJax = {
                tex: {
                    inlineMath: [['$', '$'], ['\\(', '\\)']]
                }
            };
            let csrfToken = "@(CSRF.getToken.value)";
            let examName = "@(examName)";
            let assessmentName = "@(assessmentName)";
            let state = @Html(initialState.toString);
        </script>
        <script language="JavaScript" src="@routes.Assets.versioned("javascripts/assessment.js")"></script>

        <style>
            .two-column-container {
                display: grid;
                grid-template-columns: 1fr 400px; /* Left column flexible, right column fixed width */
                gap: 20px;
                margin-top: 20px;
            }

            .left-column {
                min-width: 0; /* Prevents grid overflow issues */
            }

            .right-column {
                background-color: #f8f9fa;
                padding: 15px;
                border-left: 2px solid #dee2e6;
                height: fit-content;
            }

            /* Make it responsive */
            @@media (max-width: 768px) {
            .two-column-container {
                grid-template-columns: 1fr;
                gap: 10px;
            }
            .right-column {
                border-left: none;
                border-top: 2px solid #dee2e6;
            }
            }

            /* Style for the separator line */
            .content-separator {
                grid-column: 1 / -1;
                margin: 20px 0;
            }
        </style>
    </head>
    <body>
        <div class="two-column-container">
            <div class="left-column">
                <h1>@(title)</h1>
                @body

                <div style="background-color: lightgray">
                    <h1>Explanation</h1>
                    @explanation
                </div>

                <div style="background-color: lightblue">
                    <h1>Grading rules</h1>
                    @gradingRules
                </div>
            </div>

            <div class="right-column">
                <label for="registration">Registration number</label>
                <input id="registration" oninput="updateState('@(ElementName.registrationNumber)', this.value)"/>
                <br>
                <a href="javascript:randomStudent()">Random student...</a> |
                <a href="javascript:showDynexitePdf()">Show Dynexite PDF...</a> |
                <a href="javascript:showDynexiteLink()">Show Dynexite preview...</a>
                <br>
                <a href="javascript:loadAnswers()">Load answers...</a> |
                <a href="javascript:loadReference()">Load reference...</a> |
                <a href="javascript:dynexiteAnswers()">Raw Dynexite answers...</a>
                <h3><a href="javascript:sendState()">Grading (<span id="grading-points"></span>/@reachablePoints points)</a></h3>
                <div id="grading-report"></div>
                <script>
                    function @(ElementName.grader.jsElementCallbackName)(json) {
                        document.getElementById("grading-points").textContent = json['points']
                        document.getElementById("grading-report").innerHTML = json['report']
                        MathJax.typesetPromise()
                    }
                </script>

                <div id="errors-section" style="display: none">
                    <h3>Internal errors</h3>
                    <button onclick="clearErrors()">Clear</button>
                    <pre id="errors" style="color:red; font-weight: bold"></pre>
                    <script>
                        function @(ElementName.errordisplay.jsElementCallbackName)(json) {
                            document.getElementById('errors-section').style.display = 'block';
                            document.getElementById('errors').textContent = json['message']
                        }
                    </script>
                </div>
            </div>
        </div>
    </body>
</html>
